---
title: "Explore and consider empirical data from Yang et al. 2022"
author: "Camilla Novaglio"
date: "22/05/2023"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### AIM

consider phyto and zooplankton data fro Yang et al. 2022

### Data source 

provided by Svenja and moved to: 

*NOT WORKING* need to ask Geli... 
In the meantime I uploaded the files into the project 

scp -i /Users/camillan/.ssh/key_gem -r /Users/camillan/Desktop/SouthernOcean_data/chla_summer_data.csv ubuntu@131.217.174.44:/rd/gem/private/users/camillan/Extract_SouthernOcean_Data/YangEtAl2022_data/

scp -i /Users/camillan/.ssh/key_gem -r /Users/camillan/Desktop/SouthernOcean_data/zooplankton_summer_data.csv ubuntu@131.217.174.44:/rd/gem/private/users/camillan/Extract_SouthernOcean_Data/YangEtAl2022_data/

### Set environment 

```{r environment, echo = FALSE}

rm(list=ls())

library(raster) 
library(ggplot2) 
library(dplyr)
library(sf)
library(rnaturalearth)
library(data.table)

select<-dplyr::select
summarise<-dplyr::summarise

```

## Load adn explore data  

```{r}

# zoop<-fread("/rd/gem/private/users/camillan/Extract_SouthernOcean_Data/YangEtAl2022_data/zooplankton_summer_data.csv")

zoop<-fread("/home/ubuntu/Extract_SouthernOcean/Tmp_data/Zooplankton_summer_data.csv", data.table = FALSE)
head(zoop)
# from Email Svenja 
# you can find the "summer data" (n=2028) in sheet 2 of the attachment. The mean biomass in each cell (2° latitude × 5° logitiude) is just the simple arithmetic mean of all biomass in that cell. For example, if 40 records were found in a specific cell (160°E-165°E, 60°S-62°S), the value shown in our Fig. 2b is the mean of these 40 value. You can use "fishnet" tool in Arcgis (Arctoolbox/Data Management Tools/Sampling/Create Fishnet) to finish the average procedure. I wish this helps and feel free to contact me if you have any questions about the data or the use of Arcgis.

# define the bounding box 
min(zoop$Longitude)
max(zoop$Longitude)
# -180, 180

min(zoop$Latitude)
max(zoop$Latitude)
# -78.4, -35.183 # the modelled data is -78, -40 

phyt<-fread("/home/ubuntu/Extract_SouthernOcean/Tmp_data/chla_summer_data.csv", data.table = FALSE)
# from Email Svenja 
# Please find attached the Chl-a data from Guang to plot the circumpolar phytoplankton data. If I understood correctly, the data are in Chl mg m-3. To convert to depth-integrated g Chl m-2, you need to multiply the values by 41. Then, they assumed a C:Chl-a ratio of 60.5.

# # the finla data format needs to be like the modelled one: 
# load("/home/ubuntu/Extract_SouthernOcean/Tmp_data/01_extract_modelled_data_SO_means_narmF.RData")
# mean_all[[1]] # raster for size class 1 map
# class      : RasterLayer 
# dimensions : 38, 360, 13680  (nrow, ncol, ncell)
# resolution : 1, 1  (x, y)
# extent     : -180, 180, -78, -40  (xmin, xmax, ymin, ymax)
# crs        : +proj=longlat +datum=WGS84 +no_defs 
# source     : memory
# names      : index_1 
# values     : 1.37047, 7.065759  (min, max)



# transform in raster to explore
# need to specify CRS? 
zoop_raster<-rasterFromXYZ(zoop) 
plot(zoop_raster)

```

